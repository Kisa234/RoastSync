<ng-container *ngIf="roast ; else loading">

  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl overflow-auto">
      <!-- Header -->
      <div class="flex justify-between items-center px-6 py-4 border-b">
        <div>
          <h2 class="text-lg font-semibold">Editar roast – {{ roastId }}</h2>
          <p class="text-sm text-gray-600">Actualiza los parámetros del proceso de roast</p>
        </div>
        <button (click)="close.emit()" class="text-gray-400 hover:text-gray-600">
          <lucide-icon [img]="X" class="w-5 h-5" />
        </button>
      </div>

      <!-- Formulario -->
      <form class="grid grid-cols-3 gap-4 p-6">
        <!-- Fila 1 -->
        <div>
          <label class="block text-sm font-medium mb-1">Tostadora</label>
          <input type="text" [(ngModel)]="roast.tostadora" name="tostadora"
            class="w-full border rounded px-3 py-2 bg-gray-100" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Densidad (g/l)</label>
          <input type="number" [(ngModel)]="roast.densidad" name="densidad"
            class="w-full border rounded px-3 py-2 bg-gray-100" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Humedad (%)</label>
          <input type="number" [(ngModel)]="roast.humedad" name="humedad"
            class="w-full border rounded px-3 py-2 bg-gray-100" />
        </div>

        <!-- Fila 2 -->
        <div>
          <label class="block text-sm font-medium mb-1">Peso Entrada (kg)</label>
          <input type="number" [(ngModel)]="roast.peso_entrada" name="pesoEntrada"
            class="w-full border rounded px-3 py-2 bg-gray-100" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Temperatura Entrada (°C)</label>
          <input type="number" [(ngModel)]="roast.temperatura_entrada" name="temperaturaEntrada"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Llama Inicial (%)</label>
          <input type="number" [(ngModel)]="roast.llama_inicial" name="llamaInicial"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>

        <!-- Fila 3 -->
        <div>
          <label class="block text-sm font-medium mb-1">Aire Inicial (%)</label>
          <input type="number" [(ngModel)]="roast.aire_inicial" name="aireInicial"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Punto No Retorno (min)</label>
          <input type="number" [(ngModel)]="roast.punto_no_retorno" name="puntoNoRetorno"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Tiempo Después Crack (min)</label>
          <input type="number" [(ngModel)]="roast.tiempo_despues_crack" name="tiempoDespuesCrack"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>

        <!-- Fila 4 -->
        <div>
          <label class="block text-sm font-medium mb-1">Temperatura Crack (°C)</label>
          <input type="number" [(ngModel)]="roast.temperatura_crack" name="temperaturaCrack"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Temperatura Salida (°C)</label>
          <input type="number" [(ngModel)]="roast.temperatura_salida" name="temperaturaSalida"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Tiempo Total (min)</label>
          <input type="number" [(ngModel)]="roast.tiempo_total" name="tiempoTotal"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>

        <!-- Fila 5 -->
        <div>
          <label class="block text-sm font-medium mb-1">% Caramelización</label>
          <input type="number" [(ngModel)]="roast.porcentaje_caramelizacion" name="porcentajeCaramelizacion"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Desarrollo (%)</label>
          <input type="number" [(ngModel)]="roast.desarrollo" name="desarrollo"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Grados Desarrollo</label>
          <input type="number" [(ngModel)]="roast.grados_desarrollo" name="gradosDesarrollo"
            class="w-full border rounded px-3 py-2 focus:ring focus:ring-[#B8672E]" />
        </div>
      </form>

      <!-- Footer -->
      <div class="flex justify-end items-center gap-3 px-6 py-4 bg-gray-50 border-t">
        <button (click)="onSave()"
          class="bg-[#B8672E] text-white px-4 py-2 rounded shadow hover:bg-[#A67C52] transition">
          Actualizar roast
        </button>
        <button (click)="close.emit()" class="px-4 py-2 rounded border hover:bg-gray-100 transition">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-60">
    <p class="text-white">Cargando datos del roast…</p>
  </div>
</ng-template>