<div class="bg-white rounded-lg shadow-xl w-full overflow-visible" (click)="$event.stopPropagation()">
  <!-- HEADER -->
  <div class="flex justify-between items-center px-6 py-4 border-b">
    <h2 class="text-lg font-semibold">
      {{ mode }} Análisis Físico — {{ targetType }} {{ targetId }}
    </h2>
  </div>

  <!-- FORMULARIO -->
  <form class="grid grid-cols-5 gap-4 p-6">
    <!-- Fila 1 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Peso Muestra (g)</mat-label>
      <input matInput type="number" name="peso_muestra" [(ngModel)]="form.peso_muestra" #pesoM="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="pesoM.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="pesoM.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Peso Pergamino (g)</mat-label>
      <input matInput type="number" name="peso_pergamino" [(ngModel)]="form.peso_pergamino" #pesoP="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="pesoP.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="pesoP.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>WA (%)</mat-label>
      <input matInput type="number" name="wa" [(ngModel)]="form.wa" #wa="ngModel" required min="0" max="100"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="wa.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="wa.hasError('min')">
        El valor mínimo es 0
      </mat-error>
      <mat-error *ngIf="wa.hasError('max')">
        El valor máximo es 100
      </mat-error>
    </mat-form-field>

    <!-- Fila 2 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Temp. WA (°C)</mat-label>
      <input matInput type="number" name="temperatura_wa" [(ngModel)]="form.temperatura_wa" #tWa="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="tWa.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="tWa.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Humedad (%)</mat-label>
      <input matInput type="number" name="humedad" [(ngModel)]="form.humedad" #hum="ngModel" required min="0" max="100"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="hum.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="hum.hasError('min')">
        El valor mínimo es 0
      </mat-error>
      <mat-error *ngIf="hum.hasError('max')">
        El valor máximo es 100
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Temp. Humedad (°C)</mat-label>
      <input matInput type="number" name="temperatura_humedad" [(ngModel)]="form.temperatura_humedad" #tHum="ngModel"
        required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="tHum.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="tHum.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Fila 3 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Densidad (g/L)</mat-label>
      <input matInput type="number" name="densidad" [(ngModel)]="form.densidad" #dens="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="dens.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="dens.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Color Grano Verde</mat-label>
      <select matNativeControl name="color_grano_verde" [(ngModel)]="form.color_grano_verde" #colorG="ngModel" required
        (ngModelChange)="persist()">
        <option value="" disabled>Selecciona un color</option>
        <option *ngFor="let color of colorGranoOptions" [value]="color">
          {{ color }}
        </option>
      </select>
      <mat-error *ngIf="colorG.hasError('required')">
        Este campo es obligatorio
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Olor</mat-label>
      <select matNativeControl name="olor" [(ngModel)]="form.olor" #olor="ngModel" required (ngModelChange)="persist()">
        <option value="" disabled>Selecciona un olor</option>
        <option *ngFor="let o of olorOptions" [value]="o">
          {{ o }}
        </option>
      </select>
      <mat-error *ngIf="olor.hasError('required')">
        Este campo es obligatorio
      </mat-error>
    </mat-form-field>

    <!-- Fila 4 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Malla &gt;18</mat-label>
      <input matInput type="number" name="superior_malla_18" [(ngModel)]="form.superior_malla_18" #m18="ngModel"
        required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="m18.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="m18.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Malla &gt;16</mat-label>
      <input matInput type="number" name="superior_malla_16" [(ngModel)]="form.superior_malla_16" #m16="ngModel"
        required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="m16.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="m16.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Malla &gt;14</mat-label>
      <input matInput type="number" name="superior_malla_14" [(ngModel)]="form.superior_malla_14" #m14="ngModel"
        required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="m14.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="m14.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Fila 5 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Malla &lt;16</mat-label>
      <input matInput type="number" name="menor_malla_16" [(ngModel)]="form.menor_malla_16" #m16l="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="m16l.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="m16l.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Peso Defectos (g)</mat-label>
      <input matInput type="number" name="peso_defectos" [(ngModel)]="form.peso_defectos" #pesoD="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="pesoD.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="pesoD.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Quaquers</mat-label>
      <input matInput type="number" name="quaquers" [(ngModel)]="form.quaquers" (ngModelChange)="persist()" />
    </mat-form-field>

    <!-- Fila 6 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Peso Muestra Tostada (g)</mat-label>
      <input matInput type="number" name="peso_muestra_tostada" [(ngModel)]="form.peso_muestra_tostada"
        (ngModelChange)="persist()" />
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Desarrollo (%)</mat-label>
      <input matInput type="number" name="desarrollo" [(ngModel)]="form.desarrollo" (ngModelChange)="persist()" />
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>% Caramelización</mat-label>
      <input matInput type="number" name="porcentaje_caramelizacion" [(ngModel)]="form.porcentaje_caramelizacion"
        (ngModelChange)="persist()" />
    </mat-form-field>

    <!-- Fila 7 -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>C. Desarrollo</mat-label>
      <input matInput type="number" name="c_desarrollo" [(ngModel)]="form.c_desarrollo" (ngModelChange)="persist()" />
    </mat-form-field>

    <!-- Comentario -->
    <div class="col-span-5">
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Comentario</mat-label>
        <textarea matInput name="comentario" rows="3" [(ngModel)]="form.comentario" #comF="ngModel" maxlength="500" required
          (ngModelChange)="persist()"></textarea>
        <mat-hint align="end">{{ comF.value?.length || 0 }}/500</mat-hint>
      </mat-form-field>
    </div>
  </form>
</div>