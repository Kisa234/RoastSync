<div class="bg-white rounded-lg shadow-xl w-full overflow-visible" (click)="$event.stopPropagation()">
  <!-- HEADER -->
  <div class="flex justify-between items-center px-6 py-4 border-b">
    <h2 class="text-lg font-semibold">
      {{ mode }} Análisis Defectos — {{ targetType }} {{ targetId }}
    </h2>
  </div>

  <!-- FORM -->
  <form class="grid grid-cols-5 gap-4 p-6">
    <!-- Título Defectos Primarios -->
    <div class="col-span-5">
      <h3 class="text-md font-semibold mb-2">Defectos Primarios</h3>
    </div>

    <!-- Grano Negro -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Grano Negro</mat-label>
      <input matInput type="number" name="grano_negro" [(ngModel)]="form.grano_negro" #grNeg="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="grNeg.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="grNeg.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Grano Agrio -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Grano Agrio</mat-label>
      <input matInput type="number" name="grano_agrio" [(ngModel)]="form.grano_agrio" #grAgr="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="grAgr.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="grAgr.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Con Hongos -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Con Hongos</mat-label>
      <input matInput type="number" name="grano_con_hongos" [(ngModel)]="form.grano_con_hongos" #grHong="ngModel"
        required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="grHong.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="grHong.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Cereza Seca -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Cereza Seca</mat-label>
      <input matInput type="number" name="cereza_seca" [(ngModel)]="form.cereza_seca" #cerSec="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="cerSec.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="cerSec.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Materia Extraña -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Materia Extraña</mat-label>
      <input matInput type="number" name="materia_estrana" [(ngModel)]="form.materia_estrana" #matExt="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="matExt.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="matExt.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Broca Severa -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Broca Severa</mat-label>
      <input matInput type="number" name="broca_severa" [(ngModel)]="form.broca_severa" #broSev="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="broSev.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="broSev.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Título Defectos Secundarios -->
    <div class="col-span-5 mt-4">
      <h3 class="text-md font-semibold mb-2">Defectos Secundarios</h3>
    </div>

    <!-- Negro Parcial -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Negro Parcial</mat-label>
      <input matInput type="number" name="negro_parcial" [(ngModel)]="form.negro_parcial" #negPar="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="negPar.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="negPar.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Agrio Parcial -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Agrio Parcial</mat-label>
      <input matInput type="number" name="agrio_parcial" [(ngModel)]="form.agrio_parcial" #agrPar="ngModel" required
        min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="agrPar.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="agrPar.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Pergamino -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Pergamino</mat-label>
      <input matInput type="number" name="pergamino" [(ngModel)]="form.pergamino" #perg="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="perg.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="perg.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Flotadores -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Flotadores</mat-label>
      <input matInput type="number" name="flotadores" [(ngModel)]="form.flotadores" #flot="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="flot.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="flot.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Inmaduro -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Inmaduro</mat-label>
      <input matInput type="number" name="inmaduro" [(ngModel)]="form.inmaduro" #inmad="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="inmad.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="inmad.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Averanado -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Averanado</mat-label>
      <input matInput type="number" name="averanado" [(ngModel)]="form.averanado" #aver="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="aver.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="aver.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Conchas -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Conchas</mat-label>
      <input matInput type="number" name="conchas" [(ngModel)]="form.conchas" #conch="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="conch.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="conch.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Cáscara/Pulpa Seca -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Cáscara/Pulpa Seca</mat-label>
      <input matInput type="number" name="cascara_pulpa_seca" [(ngModel)]="form.cascara_pulpa_seca" #casp="ngModel"
        required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="casp.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="casp.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Partido/Mordido -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Partido/Mordido</mat-label>
      <input matInput type="number" name="partido_mordido_cortado" [(ngModel)]="form.partido_mordido_cortado"
        #part="ngModel" required min="0" (ngModelChange)="persist()" />
      <mat-error *ngIf="part.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="part.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Broca Leva -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Broca Leva</mat-label>
      <input matInput type="number" name="broca_leva" [(ngModel)]="form.broca_leva" #broLe="ngModel" required min="0"
        (ngModelChange)="persist()" />
      <mat-error *ngIf="broLe.hasError('required')">
        Este campo es obligatorio
      </mat-error>
      <mat-error *ngIf="broLe.hasError('min')">
        El valor mínimo es 0
      </mat-error>
    </mat-form-field>

    <!-- Grado -->
    <div class="col-span-5 mt-4">
      <mat-form-field appearance="fill" class="w-fit">
        <mat-label>Grado</mat-label>
        <input matInput type="text" name="grado" [(ngModel)]="form.grado" #gradoF="ngModel" required
          (ngModelChange)="persist()" />
        <mat-error *ngIf="gradoF.hasError('required')">
          Este campo es obligatorio
        </mat-error>
      </mat-form-field>
    </div>

  </form>
</div>