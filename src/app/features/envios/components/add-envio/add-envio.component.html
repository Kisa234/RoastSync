<div class="fixed inset-0 bg-black/30 backdrop-blur-md flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-lg overflow-visible">

    <!-- Header -->
    <div class="flex justify-between items-center px-6 pt-4">
      <div>
        <h2 class="text-xl font-semibold text-[#1F1F1F]">Nuevo Envío</h2>
        <p class="text-gray-600 text-sm">Selecciona el cliente y uno de sus lotes tostados</p>
      </div>
      <button (click)="onCancel()" class="text-gray-400 hover:text-gray-600">
        <lucide-icon [img]="X" class="w-5 h-5" />
      </button>
    </div>

    <!-- Body -->
    <div class="px-6 py-5">
      <form class="grid grid-cols-2 gap-x-6 gap-y-4">

        <!-- Cliente -->
        <div class="col-span-2">
          <label class="block text-gray-700 text-sm mb-1">Cliente *</label>
          <select-search name="cliente" [(ngModel)]="model.id_cliente" (ngModelChange)="onClienteChange($event)"
            [items]="clientes" displayField="nombre" secondDisplayField="nombre_comercial" valueField="id_user"
            placeholder="Buscar cliente">
          </select-search>
        </div>

        <!-- Lote Tostado del cliente -->
        <div class="col-span-2">
          <label class="block text-gray-700 text-sm mb-1">Lote Tostado *</label>
          <select-search name="lote" [(ngModel)]="model.id_lote_tostado" (ngModelChange)="onLoteChange($event)"
            [items]="lotesCliente" displayField="id_lote_tostado" valueField="id_lote_tostado"
            placeholder="Seleccionar lote tostado" [disabled]="!model.id_cliente || !lotesCliente.length">
          </select-search>
        </div>

        <div class="col-span-2 sm:col-span-1">
          <label class="block text-gray-700 text-sm mb-1">Cantidad disponible (gr)</label>
          <div class="relative">
            <input type="text" [value]="selectedLote?.peso | number" readonly placeholder="—"
              class="w-full border border-[#E5E5E5] rounded px-3 py-2 bg-gray-50 text-gray-700 pr-10" />
            <span class="absolute inset-y-0 right-3 flex items-center text-gray-400 text-xs">gr</span>
          </div>
        </div>

        <!-- Cantidad a enviar -->
        <div class="col-span-2 sm:col-span-1">
          <label class="block text-gray-700 text-sm mb-1">Cantidad (gr) *</label>
          <input type="number" min="1" step="1" [(ngModel)]="model.cantidad" name="cantidad"
            (ngModelChange)="validarCantidad()" class="w-full border border-[#E5E5E5] rounded px-3 py-2" />
        </div>

        <!-- Comentario -->
        <div class="col-span-2">
          <label class="block text-gray-700 text-sm mb-1">Comentario</label>
          <textarea rows="3" [(ngModel)]="model.comentario" name="comentario"
            class="w-full border border-[#E5E5E5] rounded px-3 py-2"></textarea>
        </div>

      </form>
    </div>

    <!-- Footer -->
    <div class="flex justify-end items-center px-6 py-4 border-t border-[#E5E5E5] space-x-2">
      <button (click)="onCancel()" class="px-4 py-2 rounded border border-[#A67C52] hover:bg-[#F3F2F1]">
        Cancelar
      </button>
      <button (click)="save()"
        class="px-4 py-2 rounded bg-[#B8672E] text-white hover:bg-[#A67C52] flex items-center disabled:opacity-50"
        [disabled]="saving || !canSave()">
        <lucide-icon [img]="Check" class="w-5 h-5 mr-2" />
        Guardar
      </button>
    </div>

  </div>
</div>