<!-- src/app/features/inventory/pages/inventory/lote-tostado/lote-tostado.component.html -->

<div class="h-screen p-6 bg-[#F9F9F9] overflow-auto">

  <!-- Header -->
  <div class="flex justify-between items-center mb-5">
    <div>
      <h1 class="text-2xl font-bold text-[#1F1F1F]">Café Tostado</h1>
      <p class="text-gray-600">Gestión de lotes de café tostado</p>
    </div>

    <button
      class="flex items-center bg-[#B8672E] text-white px-4 py-2 rounded shadow hover:bg-[#A67C52] transition"
      (click)="showHistoric = false">
      <lucide-icon [img]="History" class="w-5 h-5 mr-2"></lucide-icon>
      Fusionar Lotes Tostados
    </button>
  </div>

  <!-- Contenedor -->
  <div class="border border-[#E5E5E5] rounded-lg bg-white p-6 shadow-sm">

    <!-- Filtros -->
    <div class="flex gap-2.5 mb-4">

      <!-- Buscador -->
      <div class="relative w-full max-w-lg">
        <lucide-icon
          [img]="Search"
          class="absolute left-2 top-2 w-5 h-5 text-gray-400">
        </lucide-icon>

        <input
          type="text"
          [(ngModel)]="filterTextTostado"
          (ngModelChange)="onSearchChange()"
          placeholder="Buscar por cliente, productor, finca o provincia..."
          class="w-full border border-gray-300 rounded-lg pl-10 pr-4 py-2
                 focus:ring-2 focus:ring-[#B8672E] focus:outline-none text-sm" />
      </div>

      <!-- Filtros estado -->
      <div class="flex gap-x-2.5">
        <button
          *ngFor="let f of filtersTostado"
          (click)="aplicarFiltroEstado(f.key)"
          [ngClass]="
            filterTostado === f.key
              ? 'bg-[#B8672E] text-white'
              : 'bg-gray-700 text-white hover:bg-[#B8672E]'
          "
          class="transition rounded-lg px-4 py-2 text-sm">
          {{ f.label }}
        </button>
      </div>
    </div>

    <!-- Rango fechas -->
    <div class="mb-4 flex space-x-2 max-w-md">
      <input
        type="date"
        [(ngModel)]="startDate"
        (ngModelChange)="onDateChange()"
        class="w-1/2 border border-[#E5E5E5] rounded-lg px-4 py-2
               focus:outline-none focus:ring-1 focus:ring-[#B8672E]" />

      <input
        type="date"
        [(ngModel)]="endDate"
        (ngModelChange)="onDateChange()"
        class="w-1/2 border border-[#E5E5E5] rounded-lg px-4 py-2
               focus:outline-none focus:ring-1 focus:ring-[#B8672E]" />
    </div>

    <!-- Tabla -->
    <div class="rounded-lg shadow-sm overflow-x-auto">
      <table class="min-w-full table-auto divide-y divide-[#E5E5E5]">

        <thead class="bg-[#F9F9F9]">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">ID Tostado</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Productor</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Cliente</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Perfil</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Fecha</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase">Peso (gr)</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase">Acciones</th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-[#E5E5E5]">
          <tr *ngFor="let t of tostadosFiltrados">

            <td class="px-6 py-4 font-semibold text-sm text-[#1F1F1F]">
              {{ t.id_lote_tostado }}
            </td>

            <td class="px-6 py-4 text-sm text-gray-700">
              {{ t.productor }}
            </td>

            <td class="px-6 py-4 text-sm text-gray-700">
              {{ t.id_user | userName }}
            </td>

            <td class="px-6 py-4 text-sm text-gray-700">
              {{ t.perfil_tostado }}
            </td>

            <td class="px-6 py-4 text-sm text-gray-700">
              {{ t.fecha_tostado | date:'dd/MM/yyyy' }}
            </td>

            <td class="px-6 py-4 text-sm text-gray-700">
              {{ t.peso.toLocaleString('en-US') }}
            </td>

            <td class="px-6 py-4 text-right text-sm">
              <div class="flex justify-end space-x-2">

                <button
                  (click)="onReportTueste(t)"
                  class="text-gray-500 hover:text-gray-700"
                  title="Reporte">
                  <lucide-icon [img]="Clipboard" class="w-5 h-5"></lucide-icon>
                </button>

                <button
                  (click)="openHistoric(t)"
                  class="text-gray-500 hover:text-gray-700"
                  title="Histórico">
                  <lucide-icon [img]="History" class="w-5 h-5"></lucide-icon>
                </button>

                <button
                  (click)="openReportAnalisis(t)"
                  class="text-gray-500 hover:text-gray-700"
                  title="Análisis">
                  <lucide-icon
                    [img]="TestTube"
                    class="w-5 h-5"
                    [ngClass]="{ 'text-red-500': !t.id_analisis_rapido }">
                  </lucide-icon>
                </button>

                <button
                  (click)="openFicha(t)"
                  class="text-gray-500 hover:text-gray-700"
                  title="Ficha">
                  <lucide-icon [img]="Eye" class="w-5 h-5"></lucide-icon>
                </button>

                <button
                  (click)="exportStickerTostado(t)"
                  class="text-gray-500 hover:text-gray-700"
                  title="Exportar Sticker">
                  <lucide-icon [img]="Tag" class="w-5 h-5"></lucide-icon>
                </button>

              </div>
            </td>
          </tr>
        </tbody>

      </table>
    </div>
  </div>
</div>

<!-- MODALES -->

<historic-lote-tostado
  *ngIf="showHistoric"
  [loteId]="selectedTuesteId"
  (close)="showHistoric = false">
</historic-lote-tostado>

<report-lote-tostado
  *ngIf="showReport"
  [loteId]="selectedTuesteId"
  (close)="showReport = false">
</report-lote-tostado>

<ficha-tueste
  *ngIf="showFicha"
  [id]="selectedTuesteId"
  (close)="showFicha = false">
</ficha-tueste>
